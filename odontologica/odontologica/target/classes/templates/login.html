<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Clínica Tenguam</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1><a href="/index" id="voltaMenu">Login - Clínica Tenguam</a></h1>
  </header>

  <section class="content">
    <!-- Verifica se há um erro e, se sim, dispara o alert -->
    <div th:if="${erro}" th:text="${erro}" style="color: red;"></div>

    <form th:action="@{/autenticar}" method="post">
    
      <label for="cpf">CPF:</label><br>
      <input type="text" id="cpf" name="cpf" maxlength="14" required><br><br>
      <div id="mensagem"></div><br>
    
      <label for="senha">Senha:</label><br>
      <input type="password" id="senha" th:name="senha" required><br><br>
    
      <button type="submit">Entrar</button>
    </form>
    
    <a href="/cadastroUsuario" class="Cadastrar-se">Cadastrar-se</a>  
    <br><br>
    <a href="/esqueciSenha" class="esqueci a senha">Esqueci a Senha</a>  

  </section>

  <footer>
    <p>Clínica Tenguam © 2025</p>
  </footer>

  <script>
    // Função para formatar o CPF
    function formatarCPF(cpf) {
      // Remove tudo que não for número ou 'X'
      cpf = cpf.replace(/[^0-9X]/g, '').toUpperCase();

      // Se tiver 'X' não deve estar em outra posição que não seja a última
      if (cpf.slice(0, -1).includes('X')) {
        cpf = cpf.replace(/X/g, '');  // Remove todos os 'X's errados
      }

      // Aplica a máscara de CPF
      if (cpf.length <= 11) {
        cpf = cpf.replace(/(\d{3})(\d)/, '$1.$2');
        cpf = cpf.replace(/(\d{3})(\d)/, '$1.$2');
        cpf = cpf.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
      }

      return cpf;
    }

    // Função de validação do CPF
    function validarCPF(cpf) {
      const regex = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/;
      return regex.test(cpf);
    }

    // Evento de formatação e validação do CPF enquanto o usuário digita
    document.addEventListener('DOMContentLoaded', function () {
      const cpfField = document.getElementById('cpf');
      const mensagem = document.getElementById('mensagem');
      
      cpfField.addEventListener('input', function () {
        // Formata o CPF
        cpfField.value = formatarCPF(cpfField.value);

        // Valida o CPF
        if (validarCPF(cpfField.value)) {
          mensagem.textContent = 'CPF válido!';
          mensagem.style.color = 'green';
        } else {
          mensagem.textContent = 'CPF inválido! Deve estar no formato 000.000.000-00 ou 000.000.000-0X';
          mensagem.style.color = 'red';
        }
      });
    });
  </script>

</body>
</html>
