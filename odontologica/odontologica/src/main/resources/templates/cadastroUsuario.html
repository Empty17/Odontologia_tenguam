<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro de Usuário - Clínica Tenguam</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1><a href="/index" id="voltaMenu">Cadastro de Usuário</a></h1>
  </header>

  <section class="content">
    <form id="cadastroForm" action="/cadastrar" method="post" onsubmit="limparCampos();">
      <label for="cpf">CPF:</label><br>
      <input type="text" id="cpf" name="cpf" maxlength="14" required><br><br>
      <div id="mensagem"></div><br>

      <label for="nome">Nome:</label><br>
      <input type="text" id="nome" name="nome" required><br><br>

      <label for="email">Email:</label><br>
      <input type="email" id="email" name="email" required><br><br>

      <label for="senha">Senha:</label><br>
      <input type="password" id="senha" name="senha" required><br><br>

      <label for="endereco">Endereço:</label><br>
      <input type="text" id="endereco" name="endereco" required><br><br>

      <label for="dataNascimento">Data de Nascimento:</label><br>
      <input type="date" id="dataNascimento" name="dataNascimento" required><br><br>

      <label for="telefone">Telefone:</label><br>
      <input type="text" id="telefone" name="telefone" required maxlength="15"><br><br>

      <button type="submit">Cadastrar</button>
    </form>
  </section>

  <footer>
    <p>Clínica Tenguam © 2025</p>
  </footer>

  <script>
    // Função para formatar o CPF e verificar se ele tem 11 números (ou 10 números e X no final)
    const cpfField = document.querySelector('#cpf');
    const message = document.querySelector('#mensagem'); // seu elemento de feedback

    cpfField.addEventListener('input', () => {
      let v = cpfField.value.toUpperCase().replace(/[^0-9X]/g, '');

      // Se tiver X, garanta que só fique na última posição
      if (v.slice(0, -1).includes('X')) {
        v = v.replace(/X/g, ''); // remove Xs “erradas”
      }

      // Limita a 11 caracteres
      v = v.slice(0, 11);

      // Valida contagem para feedback
      const len = v.length;
      const ok = (len === 11) || (len === 10 && v.endsWith('X'));
      if (ok) {
        message.textContent = 'Formato correto!';
        message.style.color = 'green';
      } else if (len < 10) {
        message.textContent = 'CPF inválido! Deve conter 11 números ou 10 números + “X”.';
        message.style.color = 'red';
      } else {
        message.textContent = 'CPF inválido! Muito longo ou “X” na posição errada.';
        message.style.color = 'red';
      }

      // Aplica máscara conforme o padrão brasileiro
      v = v
        .replace(/(\d{3})(\d)/, '$1.$2')   // 1ª inserção de ponto
        .replace(/(\d{3})(\d)/, '$1.$2')   // 2ª inserção de ponto
        .replace(/(\d{3})([\dX]{1,2})$/, '$1-$2'); // hífen + 2 caracteres ou X

      cpfField.value = v;
    });

    // Função para formatar o telefone
    document.getElementById('telefone').addEventListener('input', function (e) {
      let telefone = e.target.value.replace(/\D/g, '');

      if (telefone.length > 11) telefone = telefone.slice(0, 11);

      if (telefone.length > 10) {
        telefone = telefone.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
      } else if (telefone.length > 5) {
        telefone = telefone.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
      } else if (telefone.length > 2) {
        telefone = telefone.replace(/^(\d{2})(\d{0,5})$/, '($1) $2');
      } else {
        telefone = telefone.replace(/^(\d*)$/, '($1');
      }

      e.target.value = telefone;
    });

    // Função para limpar a máscara antes de enviar o formulário
    function limparCampos() {
      // Limpar CPF
      let cpf = cpfField.value;
      cpf = cpf.replace(/\D/g, ''); // Remove qualquer caractere não numérico
      cpfField.value = cpf; // Atualiza o campo com o CPF limpo

      // Limpar telefone
      const telefoneField = document.querySelector('#telefone');
      let telefone = telefoneField.value;
      telefone = telefone.replace(/\D/g, ''); // Remove qualquer caractere não numérico
      telefoneField.value = telefone; // Atualiza o campo com o telefone limpo
    }
  </script>
</body>
</html>
